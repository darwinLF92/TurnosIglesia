{% extends 'aplicacion/base.html' %}
{% load static %}
{% load i18n %}

{% block content %}
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

{% language 'es' %}
<div class="container py-4 insc-page">

  <div class="insc-header mb-3">
    <div>
      <h2 class="insc-title mb-1">Inscripci√≥n en l√≠nea</h2>
      <div class="insc-subtitle">
        Procesi√≥n: <strong>{{ procesion.nombre }}</strong>
        <span class="mx-2">‚Ä¢</span>
        Fecha: <strong>{{ procesion.fecha|date:"j \\d\\e F, Y" }}</strong>
      </div>
    </div>
  </div>

  <div class="card insc-card shadow-sm">
    <div class="card-body p-4">
      <form id="formInscripcion" method="post">
        {% csrf_token %}
        <input type="hidden" name="confirmado" id="confirmado" value="0">

        <div class="mb-3">
          <label class="form-label insc-label">Seleccione su turno</label>

          {# Recomendado: agregar una clase al widget desde el form (ver nota abajo) #}
          {{ form.turno }}

          {% if form.turno.errors %}
            <div class="text-danger small mt-2">{{ form.turno.errors }}</div>
          {% endif %}
          <div class="insc-hint mt-2">
            Los turnos reservados aparecen deshabilitados.
          </div>
        </div>

        <button type="submit" class="btn insc-btn">
          Continuar
        </button>
      </form>
    </div>

    <div class="insc-note mt-3">
    <i class="bx bx-info-circle me-1"></i>
    <strong>Nota:</strong> Los Turnos Reservados (Extraordinarios) son de inscripci√≥n presencial,
    por favor consultar informaci√≥n en la p√°gina de Facebook de la hermandad para ver fechas de inscripciones.
  </div>

  </div>

</div>
{% endlanguage %}

<script>
document.addEventListener("DOMContentLoaded", function () {
  const select = document.getElementById("id_turno");
  const turnosReservados = {{ form.turnos_reservados|safe }};

  Array.from(select.options).forEach(option => {
    if (turnosReservados.includes(option.value)) {
      option.disabled = true;
      option.classList.add("turno-reservado");
    }
  });
});
</script>

{% if resumen %}
<script>
document.addEventListener('DOMContentLoaded', function () {
  const resumenHtml = `
    <div style="text-align:left">
      <p><b>Procesi√≥n:</b> {{ resumen.procesion }}</p>
      <p><b>Fecha:</b> {{ resumen.fecha|date:"d-m-Y" }}</p>
      <p><b>Turno:</b> {{ resumen.turno }}</p>
      <p><b>Valor:</b> Q{{ resumen.valor }}</p>
    </div>
  `;

  Swal.fire({
    icon: 'question',
    title: 'Confirmar inscripci√≥n',
    html: resumenHtml,
    showCancelButton: true,
    confirmButtonText: 'Aceptar',
    cancelButtonText: 'Cancelar'
  }).then((result) => {
    if (result.isConfirmed) {

      // üîπ SweetAlert de CARGA
      Swal.fire({
        title: 'Registrando su inscripci√≥n...',
        html: 'Por favor, espere un momento.',
        allowOutsideClick: false,
        allowEscapeKey: false,
        didOpen: () => {
          Swal.showLoading();

          // aqu√≠ ya mandamos el formulario
          document.getElementById('confirmado').value = "1";
          document.getElementById('formInscripcion').submit();
        }
      });

    }
  });
});
</script>
{% endif %}


{% if messages %}
<script>
document.addEventListener('DOMContentLoaded', function () {
  {% for message in messages %}
    Swal.fire({
      icon: "{% if message.tags == 'success' %}success{% elif message.tags == 'warning' %}warning{% else %}error{% endif %}",
      title: "{% if message.tags == 'success' %}√âxito{% elif message.tags == 'warning' %}Atenci√≥n{% else %}Error{% endif %}",
      text: "{{ message|escapejs }}",
      confirmButtonText: "Aceptar"
    });
  {% endfor %}
});
</script>
{% endif %}


<style>
  /* P√°gina inscripci√≥n */
.insc-page{
  max-width: 980px;
}

/* Encabezado */
.insc-header{
  display: flex;
  align-items: flex-end;
  justify-content: space-between;
  gap: 16px;
}

.insc-title{
  font-weight: 800;
  letter-spacing: .2px;
}

.insc-subtitle{
  color: #6b7280;
  font-size: .95rem;
}

/* Card moderna */
.insc-card{
  border-radius: 16px;
  border: 1px solid rgba(0,0,0,.06);
  overflow: hidden;
}

.insc-label{
  font-weight: 700;
}

/* Tip: texto de ayuda */
.insc-hint{
  font-size: .88rem;
  color: #6b7280;
}

/* Bot√≥n degradado dorado ‚Üí negro ‚Üí gris */
.insc-btn{
  border: 0 !important;
  color: #fff !important;
  font-weight: 800;
  letter-spacing: .2px;
  padding: .85rem 1.1rem;
  border-radius: 999px;

  background: linear-gradient(135deg,
    #d4af37 0%,
    #111827 48%,
    #6b7280 100%
  ) !important;

  box-shadow: 0 14px 30px rgba(0,0,0,.18);
  transition: transform .18s ease, filter .18s ease, box-shadow .18s ease;
}

.insc-btn:hover{
  filter: brightness(1.08);
  transform: translateY(-1px);
  box-shadow: 0 18px 38px rgba(0,0,0,.26);
}

/* Estilo para options reservadas */
.turno-reservado{
  color: #9ca3af !important;
  font-style: italic;
}

/* Mejor look del select (si tu widget usa form-control) */
.insc-page select{
  border-radius: 12px;
  padding: .7rem .9rem;
}

.insc-note{
  padding: 12px 14px;
  border-radius: 14px;
  border: 1px solid rgba(0,0,0,.08);
  background: rgba(212,175,55,.08); /* dorado suave */
  color: #374151;
  font-size: .92rem;
  line-height: 1.35;
}


</style>

{% endblock %}
